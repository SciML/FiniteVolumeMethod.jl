<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Mathematical Details · FiniteVolumeMethod.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">FiniteVolumeMethod.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../interface/">Interface</a></li><li><a class="tocitem" href="../docstrings/">Docstrings</a></li><li><a class="tocitem" href="../example_list/">List of Examples and Setup</a></li><li><a class="tocitem" href="../diffusion_equation/">Example I: Diffusion equation on a square plate</a></li><li><a class="tocitem" href="../diffusion_equation_on_a_wedge/">Example II: Diffusion equation in a wedge with mixed boundary conditions</a></li><li><a class="tocitem" href="../reaction_diffusion/">Example III: Reaction-diffusion equation with a time-dependent Dirichlet boundary condition on a disk</a></li><li><a class="tocitem" href="../porous_medium/">Example IV: Porous-medium equation</a></li><li><a class="tocitem" href="../porous_fisher/">Example V: Porous-Fisher equation and travelling waves</a></li><li><a class="tocitem" href="../interpolants/">Example VI: Using the linear interpolants</a></li><li class="is-active"><a class="tocitem" href>Mathematical Details</a><ul class="internal"><li><a class="tocitem" href="#Interior-discretisation"><span>Interior discretisation</span></a></li><li><a class="tocitem" href="#Boundary-conditions"><span>Boundary conditions</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Mathematical Details</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Mathematical Details</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/DanielVandH/FiniteVolumeMethod.jl/blob/main/docs/src/math.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Mathematical-Details"><a class="docs-heading-anchor" href="#Mathematical-Details">Mathematical Details</a><a id="Mathematical-Details-1"></a><a class="docs-heading-anchor-permalink" href="#Mathematical-Details" title="Permalink"></a></h1><p>We now describe the mathematical details involved with the finite volume method as we have applied it. We assume that we have some triangulation of <span>$\Omega$</span>, like a (constrained) Delaunay triangulation <span>$\mathcal D\mathcal T(\Omega)$</span>. </p><h2 id="Interior-discretisation"><a class="docs-heading-anchor" href="#Interior-discretisation">Interior discretisation</a><a id="Interior-discretisation-1"></a><a class="docs-heading-anchor-permalink" href="#Interior-discretisation" title="Permalink"></a></h2><p>This triangulation is used to define control volumes around each point. This is illustrated in the following figure, where (a) shows the domain <span>$\Omega$</span> and its triangulation <span>$\mathcal T(\Omega)$</span>, together with the boundary <span>$\partial\Omega$</span> shown in blue. (b) shows the mesh in (a) along with the dual mesh shown in blue, with red points showing the centroids of each triangle in <span>$\mathcal{T}(\Omega)$</span>. The blue polygons around each nodal point are the control volumes, and we denote the control volume around some point <span>$\boldsymbol{x}_i$</span> by <span>$\Omega_i$</span> and its boundary is <span>$\partial\Omega_i$</span>. (Note that this is the so-called ``vertex-centred approach&#39;&#39; to the finite volume method.)</p><p><img src="https://github.com/DanielVandH/FiniteVolumeMethod.jl/blob/main/test/figures/triangulation_example.png?raw=true" alt="Dual mesh"/></p><p>To be more precise, consider some interior point <span>$\boldsymbol{x}\_{i}  = (x\_i, y\_i)^{\mathsf T} \in \Omega$</span> which is a point in <span>$\mathcal T(\Omega)$</span>, i.e. one of the black points on the figure above. We take the centroids of the neighbouring triangles of <span>$\boldsymbol{x}\_i$</span> and connect these centroids to the midpoints of the associated triangle. These connections defined a closed polygon around <span>$\boldsymbol{x}\_i$</span> which we denote by <span>$\partial\Omega_i$</span>, and its interior will be <span>$\Omega\_i$</span> with some volume <span>$V\_i$</span>. This polygon will be comprised of a set of edges <span>$\mathcal E_i$</span>, and for each <span>$\boldsymbol{x}\_{\sigma} \in\mathcal E\_i$</span> there will be a length <span>$L\_\sigma$</span>, a midpoint <span>$\boldsymbol{x}\_{\sigma}$</span>, and a unit normal vector <span>$\hat{\boldsymbol{n}}\_{i, \sigma}$</span> which is normal to <span>$\sigma$</span> and directed outwards to <span>$\Omega\_i$</span> with <span>$\|\hat{\boldsymbol{n}}\_{i,\sigma}\| = 1$</span>. This notation is elucidated in the figure below. In this figure, the green area shows <span>$\Omega_i$</span>, and its boundary <span>$\partial\Omega_i$</span> is in blue. The edge <span>$\sigma$</span> is shown in blue. Lastly, the cyan points show an example ordering <span>$(v_{k1}, v_{k2}, v_{k3})$</span> of a triangle <span>$T_k \in \mathcal T(\Omega)$</span>. It is with these control volumes that we can now discretise our PDE <span>$\partial_t u + \boldsymbol{\nabla} \boldsymbol{\cdot} \boldsymbol{q} = R$</span>.</p><p><img src="https://github.com/DanielVandH/FiniteVolumeMethod.jl/blob/main/test/figures/control_volume_example.png?raw=true" alt="Control volume"/></p><p>Let us start by integrating our equations around <span>$\Omega\_i$</span> and moving the time-derivative outside the integral:</p><p class="math-container">\[\begin{equation}
\dfrac{\mathrm d}{\mathrm dt}\iint_{\Omega_i} u~ \mathrm{d}V + \iint_{\Omega_i} \boldsymbol{\nabla} \boldsymbol{\cdot} \boldsymbol{q}~ \mathrm{d}V = \iint_{\Omega_i} R~ \mathrm{d}V. 
\end{equation} \]</p><p>Using the divergence theorem, the second integral becomes</p><p class="math-container">\[\begin{equation}
\iint_{\Omega_i}  \boldsymbol{\nabla} \boldsymbol{\cdot} \boldsymbol{q}~\mathrm{d}V = \oint_{\partial\Omega_i} \boldsymbol{q} \boldsymbol{\cdot} \hat{\boldsymbol{n}}_{i, \sigma}~\mathrm{d}s = \sum_{\sigma\in \mathcal E_i} \int_\sigma \boldsymbol{q} \boldsymbol{\cdot} \hat{\boldsymbol{n}}_{i, \sigma}~\mathrm{d}s,
\end{equation}\]</p><p>where the last equality follows from integrating over each individual line segment that defines <span>$\partial\Omega_i$</span>. We now define the control volume averages,</p><p class="math-container">\[\begin{equation}
\bar u_i = \frac{1}{V_i}\iint_{\Omega_i} u~\mathrm dV, \qquad \bar R_i = \frac{1}{V_i}\iint_{\Omega_i} R~\mathrm dV,
\end{equation}\]</p><p>so that our integral formulation becomes</p><p class="math-container">\[\begin{equation}
\dfrac{\mathrm d\bar u_i}{\mathrm dt} + \frac{1}{V_i}\sum_{\sigma\in\mathcal E_i}\int_{\sigma} \boldsymbol{q} \boldsymbol{\cdot} \hat{\boldsymbol{n}}_{i, \sigma}~\mathrm ds = \bar R_i. 
\end{equation}\]</p><p>The line integrals can be approximated using a midpoint rule, </p><p class="math-container">\[\begin{equation}
\int_\sigma \boldsymbol{q} \boldsymbol{\cdot} \hat{\boldsymbol{n}}\_{i, \sigma}~\mathrm ds \approx \left[\boldsymbol{q}(x\_\sigma, y\_\sigma, t, u) \boldsymbol{\cdot} \hat{\boldsymbol{n}}\_{i, \sigma}\right] L_\sigma. 
\end{equation} \]</p><p>Lastly, the control volume averages can be approximated by simply replacing them by their value at <span>$(x\_i, y\_i)$</span>. We thus obtain the following approximation, where <span>$\tilde u\_i$</span> denotes an approximation to the exact solution <span>$u$</span> at <span>$(x_i, y_i)$</span>:</p><p class="math-container">\[\begin{equation} 
\frac{\mathrm d\tilde u_i}{\mathrm dt} + \frac{1}{V_i}\sum_{\sigma \in \mathcal E_i} \left[\boldsymbol{q}(x_\sigma, y_\sigma, t, u) \boldsymbol{\cdot} \hat{\boldsymbol{n}}\_{i, \sigma}\right] L\_\sigma = \tilde R_i,
\end{equation} \]</p><p>where <span>$\tilde R\_i$</span> is the approximation to <span>$\bar R\_i$</span> at <span>$(x\_i, y\_i)$</span>. This approximation is what we use in the interior of <span>$\Omega$</span> for approximating the value of <span>$u$</span> at each node. </p><p>We still need to discuss how we compute <span>$\boldsymbol{q}(x\_{\sigma}, y\_{\sigma}, t, u)$</span>. To deal with this function, let <span>$\mathcal T\_i$</span> be the set of triangles in <span>$\mathcal T(\Omega)$</span> that have <span>$\boldsymbol{x}\_i$</span> as a node, and consider a triangle <span>$T\_k \in \mathcal T\_i$</span>. We will inteprolate <span>$\tilde u$</span> with a linear shape function in <span>$T_k$</span>, so that </p><p class="math-container">\[\begin{equation}
\tilde u(x, y, t) = \alpha_k x + \beta_ky + \gamma_k, \quad (x, y) \in T_k.
\end{equation} \]</p><p>(The dependence of the coefficients <span>$\alpha\_k$</span>, <span>$\beta\_k$</span>, and <span>$\gamma\_k$</span> on <span>$t$</span> is suppressed.) We suppose that the three nodes defining <span>$T_k$</span> are <span>$(v\_{k1}, v\_{k2}, v\_{k3})$</span>, and these points are given in a counter-clockwise order. An example of how these points are defined was shown in the control volume schematic figure. We can find <span>$\alpha\_k$</span>, <span>$\beta\_k$</span>, and <span>$\gamma\_k$</span> by noting that we know the values of <span>$\tilde u$</span> at the nodes <span>$v\_{k1}$</span>, <span>$v\_{k2}$</span>, and <span>$v\_{k3}$</span>, either from the initial condition or from the previous time-step of the integration. We will denote the value of <span>$\tilde u$</span> at <span>$v\_{ki}$</span> by <span>$\tilde u\_{v_{ki}}$</span>, <span>$i=1,2,3$</span>. We then have the system of equations, </p><p class="math-container">\[\begin{equation} 
\tilde u_{v_{ki}} = \alpha_k x_{v_{ki}} + \beta_k y_{v_{ki}} + \gamma_k, \quad i=1,2,3, 
\end{equation} \]</p><p>where <span>$x_{v_{ki}}$</span> and <span>$y_{v_{ki}}$</span> denote the <span>$x$</span>- and <span>$y$</span>-coordinates of the point <span>$v\_{ki}$</span>, respectively, for <span>$i=1,2,3$</span>. The system can be written in matrix form as </p><p class="math-container">\[\begin{bmatrix} 
x_{v_{k1}} &amp; y_{v_{k1}} &amp; 1 \\ x_{v_{k2}} &amp; y_{v_{k2}} &amp; 1 \\ x_{v_{k3}} &amp; y_{v_{k3}} &amp; 1 \end{bmatrix}\begin{bmatrix} \alpha_k \\ \beta_k \\ \gamma_k \end{bmatrix} = \begin{bmatrix} \tilde u_{v_{k1}} \\ \tilde u_{v_{k2}} \\ \tilde u_{v_{k3}}
\end{bmatrix} \]</p><p>Using Cramer&#39;s rule, we can define </p><p class="math-container">\[\begin{equation} 
\begin{array}{lcllcllcl}
s_{k1} &amp;=&amp; \dfrac{y_{v_{k2}} - y_{v_{k3}}}{\Delta_k}, &amp; s_{k2} &amp;=&amp; \dfrac{y_{v_{k3}}-y_{v_{k1}}}{\Delta_k}, &amp; s_{k3} &amp;=&amp; \dfrac{y_{v_{k1}}-y_{v_{k2}}}{\Delta_k}, \\
s_{k4} &amp;=&amp; \dfrac{x_{v_{k3}}-x_{v_{k2}}}{\Delta_k},&amp; s_{k5} &amp;=&amp; \dfrac{x_{v_{k1}}-x_{v_{k3}}}{\Delta_k}, &amp; s_{k6} &amp;=&amp; \dfrac{x_{v_{k2}}-x_{v_{k1}}}{\Delta_k}, \\
s_{k7} &amp;=&amp; \dfrac{x_{v_{k2}}y_{v_{k3}}-x_{v_{k3}}y_{v_{k2}}}{\Delta_k}, &amp; s_{k8} &amp;=&amp; \dfrac{x_{v_{k3}}y_{v_{k1}}-x_{v_{k1}}y_{v_{k3}}}{\Delta_k},&amp; s_{k9} &amp;= &amp;\dfrac{x_{v_{k1}}y_{v_{k2}}-x_{v_{k2}}y_{v_{k1}}}{\Delta_k}, 
\end{array} 
\end{equation} \]</p><p>and </p><p class="math-container">\[\begin{equation}
\Delta_k = x_{v_{k1}}y_{v_{k2}}-x_{v_{k2}}y_{v_{k1}}-x_{v_{k1}}y_{v_{k3}}+x_{v_{k3}}y_{v_{k1}}+x_{v_{k2}}y_{v_{k3}}-x_{v_{k3}}y_{v_{k2}}.
\end{equation}\]</p><p>With this notation, </p><p class="math-container">\[\begin{equation} 
\begin{array}{rcl}
\alpha_k &amp;=&amp; s_{k1}\tilde u_{v_{k1}} + s_{k2}\tilde u_{v_{k2}} + s_{k3}\tilde u_{v_{k3}}, \\
\beta_k &amp;= &amp; s_{k4}\tilde u_{v_{k1}} + s_{k5}\tilde u_{v_{k2}} + s_{k6}\tilde u_{v_{k3}}, \\
\gamma_k &amp;=&amp; s_{k7}\tilde u_{v_{k1}} + s_{k8}\tilde u_{v_{k2}} + s_{k9}\tilde u_{v_{k3}}.
\end{array}
\end{equation} \]</p><p>With these coefficients, our approximation becomes </p><p class="math-container">\[\begin{equation} 
\frac{\mathrm du_i}{\mathrm dt} + \frac{1}{V_i}\sum_{\sigma\in\mathcal E_i} \left[\boldsymbol{q}\left(x_\sigma, y_\sigma, t, \alpha_{k(\sigma)}x_\sigma + \beta_{k(\sigma)}y_\sigma + \gamma_{k(\sigma)}\right) \boldsymbol{\cdot} \hat{\boldsymbol{n}}\_{i, \sigma}\right] L\_\sigma = R_i,
\end{equation} \]</p><p>where we now drop the tilde notation and make the approximations implicit, and now the <span>$k(\sigma)$</span> notation is used to refer to the edge <span>$\sigma$</span> inside triangle <span>$T_{k(\sigma)}$</span>. This linear shape function also allows to compute gradients like <span>$\boldsymbol{\nabla} u(x_\sigma, y_\sigma)$</span>, since <span>$\boldsymbol{\nabla} u(x_\sigma, y_\sigma) = (\alpha_{k(\sigma)}, \beta_{k(\sigma)})^{\mathsf T}$</span>.</p><h2 id="Boundary-conditions"><a class="docs-heading-anchor" href="#Boundary-conditions">Boundary conditions</a><a id="Boundary-conditions-1"></a><a class="docs-heading-anchor-permalink" href="#Boundary-conditions" title="Permalink"></a></h2><p>As discussed at the start, we only support boundary conditions of the form </p><p class="math-container">\[\begin{array}{rcl}
\boldsymbol{q}(x, y, t, u) \boldsymbol{\cdot} \hat{\boldsymbol{n}}(x, y) = 0, \\
\mathrm du(x, y, t)/\mathrm dt = a(x, y, t, u), \\
u(x, y, t) = a(x, y, t, u),
\end{array} \quad (x, y)^{\mathsf T} \in \partial\Omega.\]</p><p>For the Neumann boundary condition, recall that the integral form of our PDE was </p><p class="math-container">\[\begin{equation}
\dfrac{\mathrm d\bar u_i}{\mathrm dt} + \frac{1}{V_i}\sum_{\sigma\in\mathcal E_i}\int_{\sigma} \boldsymbol{q} \boldsymbol{\cdot} \hat{\boldsymbol{n}}_{i, \sigma}~\mathrm ds = \bar R_i. 
\end{equation}\]</p><p>Thus, if <span>$\sigma$</span> is an edge such that <span>$\boldsymbol{q} \boldsymbol{\cdot} \hat{\boldsymbol{n}} = 0$</span>, then the contribution from <span>$\sigma$</span> to the above sum is zero. Thus, in our code, we simply skip over such a <span>$\sigma$</span> when computing the sum. </p><p>For the time-dependent Dirichlet boundary condition, we can skip over nodes with this condition and simply set <span>$\mathrm du\_i/\mathrm dt = a(x, y, t, u)$</span>. </p><p>Lastly, for the Dirichlet boundary conditions, we leave <span>$\mathrm du\_i/\mathrm dt = 0$</span> and simply update the value of <span>$u\_i$</span> with <span>$a(x, y, t, u\_i)$</span> at the end of each iteration. This is done using callbacks.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../interpolants/">« Example VI: Using the linear interpolants</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Wednesday 21 December 2022 18:10">Wednesday 21 December 2022</span>. Using Julia version 1.8.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
