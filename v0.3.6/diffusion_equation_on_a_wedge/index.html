<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Example II: Diffusion equation in a wedge with mixed boundary conditions · FiniteVolumeMethod.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">FiniteVolumeMethod.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../interface/">Interface</a></li><li><a class="tocitem" href="../docstrings/">Docstrings</a></li><li><a class="tocitem" href="../example_list/">List of Examples and Setup</a></li><li><a class="tocitem" href="../diffusion_equation/">Example I: Diffusion equation on a square plate</a></li><li class="is-active"><a class="tocitem" href>Example II: Diffusion equation in a wedge with mixed boundary conditions</a><ul class="internal"><li><a class="tocitem" href="#Setting-up-the-problem"><span>Setting up the problem</span></a></li><li><a class="tocitem" href="#Solving-the-problem-and-visualising-the-solution"><span>Solving the problem and visualising the solution</span></a></li></ul></li><li><a class="tocitem" href="../reaction_diffusion/">Example III: Reaction-diffusion equation with a time-dependent Dirichlet boundary condition on a disk</a></li><li><a class="tocitem" href="../porous_medium/">Example IV: Porous-medium equation</a></li><li><a class="tocitem" href="../porous_fisher/">Example V: Porous-Fisher equation and travelling waves</a></li><li><a class="tocitem" href="../interpolants/">Example VI: Using the linear interpolants</a></li><li><a class="tocitem" href="../math/">Mathematical Details</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Example II: Diffusion equation in a wedge with mixed boundary conditions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Example II: Diffusion equation in a wedge with mixed boundary conditions</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/DanielVandH/FiniteVolumeMethod.jl/blob/main/docs/src/diffusion_equation_on_a_wedge.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Example-II:-Diffusion-equation-in-a-wedge-with-mixed-boundary-conditions"><a class="docs-heading-anchor" href="#Example-II:-Diffusion-equation-in-a-wedge-with-mixed-boundary-conditions">Example II: Diffusion equation in a wedge with mixed boundary conditions</a><a id="Example-II:-Diffusion-equation-in-a-wedge-with-mixed-boundary-conditions-1"></a><a class="docs-heading-anchor-permalink" href="#Example-II:-Diffusion-equation-in-a-wedge-with-mixed-boundary-conditions" title="Permalink"></a></h1><p>Now we consider the following problem defined on a wedge with angle <span>$\alpha$</span> and mixed boundary conditions:</p><p class="math-container">\[\begin{equation*}
\begin{array}{rcll}
\dfrac{\partial u(r, \theta, t)}{\partial t} &amp; = &amp; \boldsymbol{\nabla}^2 u(r, \theta, t), &amp; 0 &lt; r &lt; 1, 0 &lt; \theta &lt; \alpha, t&gt;0, \\
\dfrac{\partial u(r, 0, t)}{\partial \theta} &amp; = &amp; 0, &amp; 0 &lt; r &lt; 1, t&gt;0, \\
\dfrac{\partial u(r, \alpha,t)}{\partial \theta} &amp; = &amp; 0, &amp; 0 &lt; \theta &lt; \alpha, t&gt;0, \\
u(r,\theta,0) &amp; = &amp; f(r, \theta), &amp; 0 &lt; r &lt; 1, 0&lt; \theta &lt; \alpha.
\end{array}
\end{equation*}\]</p><p>(The exact solution to this problem, found by writing <span>$u(r, \theta, t) = \mathrm{e}^{-\lambda t}v(r, \theta)$</span> and then using separation of variables, can be shown to take the form</p><p class="math-container">\[u(r, \theta, t) = \frac12\sum_{m=1}^\infty A_{0,m}\mathrm{e}^{-\zeta_{0,m}^2t}J_0\left(\zeta_{0,m}r\right) + \sum_{n=1}^\infty\sum_{m=1}^\infty A_{n,m}\mathrm{e}^{-\zeta_{n,m}^2t}J_{n\mathrm{\pi}/\alpha}\left(\zeta_{n\mathrm{\pi}/\alpha, m}r\right)\cos\left(\frac{n\mathrm{\pi}\theta}{\alpha}\right),\]</p><p>math</p><p>where, assuming <span>$f$</span> can be expanded into a Fourier-Bessel series,</p><p class="math-container">\[A_{n, m} = \frac{4}{\alpha J_{n\mathrm{\pi}/\alpha + 1}^2\left(\zeta_{n\mathrm{\pi}/\alpha,m}\right)}\int_0^1\int_0^\alpha f(r, \theta)J_{n\mathrm{\pi}/\alpha}\left(\zeta_{n\mathrm{\pi}/\alpha,m}r\right)\cos\left(\frac{n\mathrm{\pi}\theta}{\alpha}\right)r~\mathrm{d}r~\mathrm{d}\theta, \quad n=0,1,2,\ldots,m=1,2,\ldots,\]</p><p>and we write the roots of <span>$J_\mu$</span>, the <span>$\zeta_{\mu, m}$</span> such that <span>$J_\mu(\zeta_{\mu, m}) = 0$</span>, in the form <span>$0 &lt; \zeta_{\mu, 1} &lt; \zeta_{\mu, 2} &lt; \cdots$</span> with <span>$\zeta_{\mu, m} \to \infty$</span> as <span>$m \to \infty$</span>. This is the exact solution we compare to in the tests; comparisons not shown here.) We take <span>$\alpha = \mathrm{\pi}/4$</span> and <span>$f(r, \theta) = 1 - r$</span>. </p><p>Note that the PDE is provided in polar form, but Cartesian coordinates are assumed for the operators in our code. The conversion is easy, noting that the two Neumann conditions are just equations of the form <span>$\boldsymbol{\nabla} u \boldsymbol{\cdot} \hat{\boldsymbol{n}} = 0$</span>. Moreover, although the right-hand side of the PDE is given as a Laplacian, recall that <span>$\boldsymbol{\nabla}^2 = \boldsymbol{\nabla} \boldsymbol{\cdot} \boldsymbol{\nabla}$</span>, so we can write <span>$\partial u/\partial t + \boldsymbol{\nabla} \boldsymbol{\cdot} \boldsymbol{q} = 0$</span>, where <span>$\boldsymbol{q} = -\boldsymbol{\nabla} u$</span>, or <code>q(x, y, t, α, β, γ, p) = (-α, -β)</code> in the notation in our code.</p><h2 id="Setting-up-the-problem"><a class="docs-heading-anchor" href="#Setting-up-the-problem">Setting up the problem</a><a id="Setting-up-the-problem-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-up-the-problem" title="Permalink"></a></h2><p>Let us now solve the problem. Again, we start by defining the mesh. Since the boundary condition is different on each segment, we keep each segment as a different vector.</p><pre><code class="language-julia hljs">using DelaunayTriangulation, FiniteVolumeMethod

n = 500
α = π / 4

# The bottom edge 
r₁ = LinRange(0, 1, n)
θ₁ = LinRange(0, 0, n)
x₁ = @. r₁ * cos(θ₁)
y₁ = @. r₁ * sin(θ₁)

# Arc 
r₂ = LinRange(1, 1, n)
θ₂ = LinRange(0, α, n)
x₂ = @. r₂ * cos(θ₂)
y₂ = @. r₂ * sin(θ₂)

# Upper edge 
r₃ = LinRange(1, 0, n)
θ₃ = LinRange(α, α, n)
x₃ = @. r₃ * cos(θ₃)
y₃ = @. r₃ * sin(θ₃)

# Combine and create the mesh 
x = [x₁, x₂, x₃]
y = [y₁, y₂, y₃]
r = 0.01
(T, adj, adj2v, DG, points), BN = generate_mesh(x, y, r; gmsh_path=GMSH_PATH)
mesh = FVMGeometry(T, adj, adj2v, DG, points, BN)
# You could also do:
# tri, BN = generate_mesh(x, y, r; gmsh_path=GMSH_PATH)
# mesh = FVMGeometry(tri, BN) # for DelaunayTriangulation &gt;= v0.3)</code></pre><p>Now we define the boundary conditions.</p><pre><code class="language-julia hljs">lower_bc = ((x, y, t, u::T, p) where {T}) -&gt; zero(T)
arc_bc = ((x, y, t, u::T, p) where {T}) -&gt; zero(T)
upper_bc = ((x, y, t, u::T, p) where {T}) -&gt; zero(T)
types = (:N, :D, :N)
boundary_functions = (lower_bc, arc_bc, upper_bc)
BCs = BoundaryConditions(mesh, boundary_functions, types, BN)</code></pre><p>Next, the PDE itself:</p><pre><code class="language-julia hljs">f = (x, y) -&gt; 1 - sqrt(x^2 + y^2)
D = ((x, y, t, u::T, p) where {T}) -&gt; one(T)
u₀ = f.(points[1, :], points[2, :])
final_time = 0.1 # Do not need iip_flux = true or R(x, y, t, u, p) = 0, these are defaults 
prob = FVMProblem(mesh, BCs; diffusion_function=D, initial_condition=u₀, final_time)</code></pre><p>This formulation uses the diffusion function rather than the flux function, but you could also use the flux function formulation:</p><pre><code class="language-julia hljs">flux = (q, x, y, t, α, β, γ, p) -&gt; (q[1] = -α; q[2] = -β; nothing)
prob2 = FVMProblem(mesh, BCs; diffusion_function=D, initial_condition=u₀, final_time)</code></pre><h2 id="Solving-the-problem-and-visualising-the-solution"><a class="docs-heading-anchor" href="#Solving-the-problem-and-visualising-the-solution">Solving the problem and visualising the solution</a><a id="Solving-the-problem-and-visualising-the-solution-1"></a><a class="docs-heading-anchor-permalink" href="#Solving-the-problem-and-visualising-the-solution" title="Permalink"></a></h2><p>Finally, we can solve and visualise the problem. </p><pre><code class="language-julia hljs">using OrdinaryDiffEq, LinearSolve

alg = Rosenbrock23(linsolve=UMFPACKFactorization())
sol = solve(prob, alg; saveat=0.025)</code></pre><pre><code class="language-julia hljs">using CairoMakie 

pt_mat = Matrix(points&#39;)
T_mat = [collect(T)[i][j] for i in 1:length(T), j in 1:3]
fig = Figure(resolution=(2131.8438f0, 684.27f0), fontsize=38)
ax = Axis(fig[1, 1], width=600, height=600)
mesh!(ax, pt_mat, T_mat, color=sol.u[1], colorrange=(0, 0.5), colormap=:matter)
ax = Axis(fig[1, 2], width=600, height=600)
mesh!(ax, pt_mat, T_mat, color=sol.u[3], colorrange=(0, 0.5), colormap=:matter)
ax = Axis(fig[1, 3], width=600, height=600)
mesh!(ax, pt_mat, T_mat, color=sol.u[5], colorrange=(0, 0.5), colormap=:matter)</code></pre><p><img src="https://github.com/DanielVandH/FiniteVolumeMethod.jl/blob/main/test/figures/diffusion_equation_wedge_test.png?raw=true" alt="Heat equation on a wedge solution"/></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../diffusion_equation/">« Example I: Diffusion equation on a square plate</a><a class="docs-footer-nextpage" href="../reaction_diffusion/">Example III: Reaction-diffusion equation with a time-dependent Dirichlet boundary condition on a disk »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Wednesday 21 December 2022 18:10">Wednesday 21 December 2022</span>. Using Julia version 1.8.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
